FROM apache/spark:3.5.7

USER root

# Install uv
RUN curl -LsSf https://astral.sh/uv/install.sh | sh && \
    mv /root/.local/bin/uv /usr/local/bin/

# Install pandas and pyspark using uv
RUN uv pip install --system --no-cache pandas==2.0.3 pyspark==3.5.7

# Copy custom log4j configuration to suppress native library warning
COPY conf/log4j2.properties /opt/spark/conf/log4j2.properties

# Switch back to spark user for security
USER spark

WORKDIR /opt/spark/work-dir
